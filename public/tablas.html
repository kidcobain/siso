<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>tablas</title>
	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
	<link href="css/bootstrap-datepicker3.min.css" rel="stylesheet">
	<style type="text/css">
		table, td, th {border:1px solid silver; border-collapse:collapse; padding:3px 6px;}
	</style>
	
</head>
<body> 
	
	<table class="latabla">
		<tr>
			<tr>
				<th>lote</th>
				<th colspan="3">Reposicion por poliducto</th>
				<th colspan="3">Inventario inicial</th>
				<th colspan="3">Inventario final</th>
				<th colspan="3">Autonomia</th>
			</tr>
			<tr>
				<th>nombre</th>
				<th>G95</th> <th>G91</th> <th>DSL</th>
				<th>G95</th> <th>G91</th> <th>DSL</th>
				<th>G95</th> <th>G91</th> <th>DSL</th>
				<th>G95</th> <th>G91</th> <th>DSL</th>
			</tr>
			
			<tr class="datos 198-DSL199-G95" id="198-DSL199-G95">
				<td class="nombrelote">198-DSL199-G95</td>

				<td class="reposicion G95">5</td>
				<td class="reposicion G91">9</td>
				<td class="reposicion DSL">0</td>

				<td class="inicial G95">5</td>
				<td class="inicial G91">5</td>
				<td class="inicial DSL">1</td>

				<td class="final G95">2</td>
				<td class="final G91">3</td>
				<td class="final DSL">0</td>

				<td class="autonomia G95">3</td>
				<td class="autonomia G91">5</td>
				<td class="autonomia DSL">7</td>
			</tr>
		
		
		</tr>
	</table>
	<p></p>
	<input type="button" class="agregar" value="agregar nueva fila">

		<div class="input-group date">
		  <input type="text" class="form-control form-date">
		  <input type="text" class="form-control dada">
		  	<span class="input-group-addon">
		  		<i class="glyphicon glyphicon-th"></i>
		  	</span>
		</div>
</body>
<script src="js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="js/bootstrap-datepicker.js"></script>
<script src="js/bootstrap-datepicker.es.min.js" type="text/javascript"></script>
<script src="js/jquery.maskedinput.min.js" type="text/javascript"></script>
	<script>
		var elhtml = ' \
			<tr class="datos " id="">  \
				<td class="nombrelote"><input class="editando" type="text" /></td> \
 \
				<td class="reposicion G95">0</td> \
				<td class="reposicion G91">0</td> \
				<td class="reposicion DSL">0</td> \
 \
				<td class="inicial G95">0</td> \
				<td class="inicial G91">0</td> \
				<td class="inicial DSL">0</td> \
 \
				<td class="final G95">0</td> \
				<td class="final G91">0</td> \
				<td class="final DSL">0</td> \
 \
				<td class="autonomia G95">0</td> \
				<td class="autonomia G91">0</td> \
				<td class="autonomia DSL">0</td> \
			</tr> \
		';

	$(document).ready(function() {
		
		
		
				

		var editarCelda = function () {

			var texto = $(this).text();

			$(this).html('<input class="editando" type="text" value="'+texto+'">');
			var $el = $(this).find('input');

				$el.focus();
				$el.click(function(event){
				    event.stopPropagation();
				});
				$('.latabla').off('click','td');
			$('.agregar').off('click');
		};

		var agregarFila = function () {

			$('tr:last').after(elhtml);
			//var el = $('tr:last > td');
			$('tr:last').css('background-color', 'gray');
			$('.agregar').off('click');
			$('.latabla').off('click','td');

			var el = $('.editando');

			el.click(function(event){
			    event.stopPropagation();
			});
			el.focus();

			//$('.latabla').off('click', 'tr:last >td');
		};

		var guardarDatoCelda = function () {
			var $el = $('.editando');

			var valor = $el.val();

			var idfila = 0;
			var colfila = 0;
			var tipofila = 0;

			// $(element).attr("class").split(' ');
			 var clases = $('.editando').parent().attr("class").split(' ');
			 //console.log(clases);

			 colfila = clases[0] || 0;
			 tipofila = clases[1] || 0;

			
			
			trow = $el.parent().parent();

			if($el.parent().hasClass('nombrelote')){
				trow.attr('id', valor)
			}
			idfila = trow.attr('id');
			console.log(idfila);

			if (!valor || valor == "" ) {
				if($el.parent().hasClass('nombrelote')){

					$(this).parent().parent().css('background-color', 'gray');
				}
				valor = 0;
			}
			else{

				$el.parent().text(valor);
				trow.css('background-color', '');
				$('.latabla').on('click','td', editarCelda);
				//trow.find('td').on('click', editarCelda);
				$('.agregar').on('click',agregarFila);
				//url: '/datosAjax/InventarioPoliducto',

				/*
					
					$.ajax({
							    type: 'get',
							    url: '/sisor/public/datosAjax/InventarioPoliducto',
							    data: {
							        tipo: 'a',
							        nombre: 'a',
							        fecha_entrada: 'a',
							        fecha_salida: 'a',
							        proyeccion_tipo: 'a',
							        g95: 'a',
							        g91: 'a',
							        dsl: 'a',
							        lote_id: 'a',


							    },
							    dataType: 'json',
							    complete: function(){ 
							        alert('listo');
							    },

							    success: function(){
							        alert('exito');
							    }
							});
				*/

				$.ajax({
						    type: 'get',
						    url: '/InventarioPoliducto',
						    data: {
						        valor:valor,

						        idfila: idfila,
						        colfila: colfila,
						        tipofila: tipofila,
						        lote_id: idfila,


						    },
						    
						    dataType: 'json',
						    complete: function(){ 
						        //alert('listo');
						    },

						    success: function(){
						        //alert('exito');
						    }
						});


					
			}
			
		};


		$('.latabla ').on('click','td', editarCelda);

		$('.latabla').on('blur','.editando', guardarDatoCelda);
				
		$('.agregar').on('click',agregarFila);

		//$('td ').on('click', editarCelda);
			//$('.latabla > td ').on('click', editarCelda);
			//verificar campo editando de nombrelote
			//if (!el.parent('.datos').attr('id') == undefined) {}
			//console.log('jaja');
			//console.log($(this).text());
			//$(this).parent().attr('id', $(this).text());
			//$('#asdf > .inicial.DSL').text(5);
			//$('#198-DSL199-G95 > .inicial.DSL').css('opacity','0.3')
			//$('tr:last').after($('.datos:first').clone(true));
			//.attr("id","capainterior3")

			$('.form-date').datepicker({
			    format: "dd/mm/yyyy",
			    maxViewMode: 3,
			    todayBtn: "linked",
			    clearBtn: true,
			    language: "es",
			    autoclose: true
			});

			$(".dada").mask("999-aaa-999-a99",{placeholder:"000-xxx-000-x00"});
			//$(body).on('asdf','.editando .nombrelote',mask("999-aaa-999-a99"));

			
			

		
	});
	</script>

</html>



